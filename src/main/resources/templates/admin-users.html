<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/header :: head}">
    <title>Управление пользователями - Online School</title>
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>
    
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-title">
                    <nav class="breadcrumb-nav">
                        <a href="/admin" class="breadcrumb-link">
                            <i class="fas fa-cog"></i> Админ панель
                        </a>
                        <i class="fas fa-chevron-right"></i>
                        <span class="breadcrumb-current">Пользователи</span>
                    </nav>
                    <h1><i class="fas fa-users"></i> Управление пользователями</h1>
                    <p>Просмотр и управление всеми пользователями системы</p>
                </div>
                <div class="page-actions">
                    <a href="/admin/users/new" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Добавить пользователя
                    </a>
                </div>
            </div>

            <!-- Users Table -->
            <div class="table-container">
                <div class="table-header">
                    <h3>Список пользователей</h3>
                    <div class="table-filters">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Поиск пользователей..." class="form-control">
                        </div>
                        <select class="form-control">
                            <option value="">Все роли</option>
                            <option value="ADMIN">Администраторы</option>
                            <option value="TEACHER">Преподаватели</option>
                            <option value="STUDENT">Студенты</option>
                        </select>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Пользователь</th>
                                <th>Email</th>
                                <th>Роль</th>
                                <th>Статус</th>
                                <th>Дата регистрации</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="user : ${users}">
                                <td th:text="${user.id}">1</td>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="user-details">
                                            <strong th:text="${user.firstName + ' ' + user.lastName}">Имя Фамилия</strong>
                                            <small th:text="${user.username}">username</small>
                                        </div>
                                    </div>
                                </td>
                                <td th:text="${user.email}">email@example.com</td>
                                <td>
                                    <span class="role-badge" 
                                          th:classappend="${user.role.name() == 'ADMIN'} ? 'admin' : (${user.role.name() == 'TEACHER'} ? 'teacher' : 'student')"
                                          th:text="${user.role.name() == 'ADMIN'} ? 'Админ' : (${user.role.name() == 'TEACHER'} ? 'Учитель' : 'Студент')">
                                        Роль
                                    </span>
                                </td>
                                <td>
                                    <span class="status-badge" 
                                          th:classappend="${user.active} ? 'active' : 'inactive'"
                                          th:text="${user.active} ? 'Активен' : 'Неактивен'">
                                        Статус
                                    </span>
                                </td>
                                <td th:text="${#temporals.format(user.createdAt, 'dd.MM.yyyy')}">01.01.2024</td>
                                <td>
                                    <div class="action-buttons">
                                        <a th:href="@{/admin/users/{id}/edit(id=${user.id})}" 
                                           class="btn btn-sm btn-outline-primary" 
                                           title="Редактировать">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <button type="button" 
                                                class="btn btn-sm btn-outline-danger" 
                                                title="Удалить"
                                                onclick="confirmDelete(this)"
                                                th:data-user-id="${user.id}"
                                                th:data-user-name="${user.username}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div th:if="${users.empty}" class="empty-state">
                    <i class="fas fa-users"></i>
                    <h3>Пользователи не найдены</h3>
                    <p>В системе пока нет пользователей</p>
                    <a href="/admin/users/new" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Добавить первого пользователя
                    </a>
                </div>
            </div>
        </div>
    </main>
    
    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
        function confirmDelete(button) {
            const userId = button.getAttribute('data-user-id');
            const userName = button.getAttribute('data-user-name');
            
            if (confirm(`Вы уверены, что хотите удалить пользователя "${userName}"?`)) {
                // Здесь можно добавить AJAX запрос для удаления
                fetch(`/admin/users/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('Ошибка при удалении пользователя');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Ошибка при удалении пользователя');
                });
            }
        }

        // Поиск пользователей
        document.querySelector('.search-box input').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    </script>
</body>
</html> 