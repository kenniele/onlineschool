# Онлайн-школа (Online School)

## Структура проекта

```
com.onlineSchool
├── config
│   └── TestSecurityConfig.java
├── controller
│   ├── CommentController.java
│   ├── CourseController.java
│   ├── LikeController.java
│   ├── UserController.java
│   └── WebinarController.java
├── model
│   ├── Comment.java
│   ├── Course.java
│   ├── Like.java
│   ├── Role.java
│   ├── User.java
│   └── Webinar.java
├── repository
│   ├── CommentRepository.java
│   ├── CourseRepository.java
│   ├── LikeRepository.java
│   ├── UserRepository.java
│   └── WebinarRepository.java
├── service
│   ├── CommentService.java
│   ├── CourseService.java
│   ├── LikeService.java
│   ├── UserService.java
│   └── WebinarService.java
└── OnlineSchoolApplication.java
```

## Бизнес-логика

Проект представляет собой веб-приложение онлайн-школы, которое обеспечивает функционал для:

1. **Управления пользователями**:
   - Регистрация и аутентификация пользователей
   - Управление ролями (ADMIN, STUDENT)
   - Обновление профилей пользователей

2. **Управления курсами**:
   - Создание и публикация курсов
   - Активация/деактивация курсов
   - Запись студентов на курсы
   - Отмена записи студентов с курсов

3. **Управления вебинарами**:
   - Создание вебинаров в рамках курсов
   - Планирование и проведение вебинаров
   - Управление доступом к вебинарам

4. **Взаимодействия пользователей**:
   - Добавление комментариев к вебинарам
   - Выставление лайков к комментариям
   - Модерация комментариев

## Модель данных и связи

### User
- **Поля**: id, username, password, email, firstName, lastName, role, active, createdAt
- **Связи**:
  - One-to-Many с Course (как автор)
  - Many-to-Many с Course (как студент)
  - One-to-Many с Comment
  - One-to-Many с Like

### Course
- **Поля**: id, title, description, active, createdAt, author
- **Связи**:
  - Many-to-One с User (автор курса)
  - Many-to-Many с User (записанные студенты)
  - One-to-Many с Webinar

### Webinar
- **Поля**: id, title, description, startDate, endDate, course, createdAt
- **Связи**:
  - Many-to-One с Course
  - One-to-Many с Comment

### Comment
- **Поля**: id, content, webinar, user, createdAt
- **Связи**:
  - Many-to-One с Webinar
  - Many-to-One с User
  - One-to-Many с Like

### Like
- **Поля**: id, comment, user, createdAt
- **Связи**:
  - Many-to-One с Comment
  - Many-to-One с User

## REST API

### UserController (путь /api/users)

| Метод | Эндпоинт | Описание | Права доступа |
|-------|----------|----------|---------------|
| GET | / | Получить всех пользователей | ADMIN |
| GET | /{id} | Получить пользователя по ID | ADMIN |
| POST | / | Создать нового пользователя | ADMIN |
| PUT | /{id} | Обновить пользователя по ID | ADMIN |
| DELETE | /{id} | Удалить пользователя по ID | ADMIN |
| PUT | /me | Обновить собственный профиль | Аутентифицированный пользователь |

### CourseController (путь /api/courses)

| Метод | Эндпоинт | Описание | Права доступа |
|-------|----------|----------|---------------|
| GET | / | Получить все курсы | Все |
| GET | /active | Получить активные курсы | Все |
| GET | /{id} | Получить курс по ID | Все |
| POST | / | Создать новый курс | ADMIN |
| PUT | /{id} | Обновить курс по ID | ADMIN |
| DELETE | /{id} | Удалить курс по ID | ADMIN |
| POST | /{courseId}/students/{userId} | Записать студента на курс | ADMIN |
| DELETE | /{courseId}/students/{userId} | Отписать студента от курса | ADMIN |
| PUT | /{id}/activate | Активировать курс | ADMIN |
| PUT | /{id}/deactivate | Деактивировать курс | ADMIN |

### WebinarController (путь /api/webinars)

| Метод | Эндпоинт | Описание | Права доступа |
|-------|----------|----------|---------------|
| GET | / | Получить все вебинары | Все |
| GET | /{id} | Получить вебинар по ID | Все |
| GET | /course/{courseId} | Получить вебинары курса | Все |
| POST | / | Создать новый вебинар | ADMIN |
| PUT | /{id} | Обновить вебинар по ID | ADMIN |
| DELETE | /{id} | Удалить вебинар по ID | ADMIN |

### CommentController (путь /api/comments)

| Метод | Эндпоинт | Описание | Права доступа |
|-------|----------|----------|---------------|
| GET | / | Получить все комментарии | Все |
| GET | /{id} | Получить комментарий по ID | Все |
| GET | /webinar/{webinarId} | Получить комментарии вебинара | Все |
| POST | / | Создать новый комментарий | Аутентифицированный пользователь |
| PUT | /{id} | Обновить комментарий по ID | Владелец комментария или ADMIN |
| DELETE | /{id} | Удалить комментарий по ID | Владелец комментария или ADMIN |

### LikeController (путь /api/likes)

| Метод | Эндпоинт | Описание | Права доступа |
|-------|----------|----------|---------------|
| GET | / | Получить все лайки | Все |
| GET | /{id} | Получить лайк по ID | Все |
| GET | /comment/{commentId} | Получить лайки комментария | Все |
| POST | / | Создать новый лайк | Аутентифицированный пользователь |
| DELETE | /{id} | Удалить лайк по ID | Владелец лайка или ADMIN |

## Компоненты системы и их взаимодействие

### Слой контроллеров
Контроллеры обрабатывают HTTP-запросы, проверяют права доступа и делегируют бизнес-логику сервисам. Они также отвечают за валидацию входных данных и формирование HTTP-ответов.

### Слой сервисов
Сервисы содержат бизнес-логику приложения, они:
- Обрабатывают запросы от контроллеров
- Работают с репозиториями для доступа к данным
- Реализуют бизнес-правила и валидацию
- Координируют транзакции

### Слой репозиториев
Репозитории обеспечивают доступ к базе данных и операции CRUD (Create, Read, Update, Delete) для моделей:
- Используют Spring Data JPA для абстрагирования доступа к БД
- Обеспечивают пользовательские запросы к БД

### Модели данных
Модели представляют сущности приложения и их связи. Они аннотированы для JPA и включают:
- Бизнес-данные (поля)
- Связи между сущностями (аннотации @OneToMany, @ManyToOne и т.д.)
- Методы доступа к данным (геттеры и сеттеры)

### Безопасность
Безопасность управляется через Spring Security:
- Аутентификация на основе Form-based аутентификации
- Авторизация на основе ролей и аннотаций @PreAuthorize
- Защита REST API с помощью CSRF-токенов

## Архитектурные особенности

1. **Многоуровневая архитектура**:
   - Отделение контроллеров от бизнес-логики и доступа к данным
   - Четкое разделение ответственности между слоями

2. **REST API**:
   - Использование принципов REST для создания API
   - Использование HTTP-методов для обозначения операций
   - Представление ресурсов в формате JSON

3. **Безопасность**:
   - Разграничение доступа по ролям
   - Защита чувствительных операций
   - Аутентификация пользователей

4. **Тестирование**:
   - Интеграционные тесты для контроллеров
   - Тесты бизнес-логики
   - Настройка тестового окружения с использованием H2 базы данных

## Технологический стек

- **Основа**: Spring Boot
- **Работа с базой данных**: Spring Data JPA, Hibernate
- **Безопасность**: Spring Security
- **Тестирование**: JUnit, Spring Test, MockMvc
- **Документация**: JavaDoc 